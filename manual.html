<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
	<script src="tools/jquery-3.1.1.min.js"></script>
	<script src="clarino.js"></script>

	<script>
	(function($, $C){
		//console.log($C);
		var $H = $C.simple;

		var px = $C.css.unit.px,
			pc = $C.css.unit.pc,
			css = $C.css.keywords;

		var Settings = {
			title: $C.format('Clarino v.{0} - руководство пользователя', Clarino.version()),
			link:{
				color:{
					lo:'#00a',
					hi:'#06a'
				}
			}
		};

		$C.css.writeStylesheet({
			'h1,h2,h3,h4':{
				marginBottom:px(0)
			},
			'.manual':{
				fontFamily: 'Verdana, Arial, Sans-Serif',
				fontSize: px(14),
				' a':{
					':link':{color:Settings.link.color.lo},
					':visited':{color:Settings.link.color.lo},
					':hover':{color:Settings.link.color.hi}
				},
				' .button':{
					cursor: css.pointer
				},
				' .navbar':{
					backgroundColor: '#eee',
					padding: px(3, 50),
					margin: px(0, 0, 20, 0),
					' a':{
						':link':{textDecoration:css.none},
						':visited':{textDecoration:css.none},
						':hover':{textDecoration:css.underline}
					}
				},
				' .code':{
					backgroundColor: '#eaeaea',
					fontFamily: 'Courier New, Monospace'
				},
				' .pnlErrorsDetected':{
					display: css.none,
					backgroundColor: '#ffc',
					padding: px(10),
					fontWeight: css.bold,
					border: px(1)+' solid #f00'
				},
				' .success':{color:'#080'},
				' .error':{color:'#e00'}
			}
		});

		var uid = (function(){
			var counter = 1;
			return function(){
				return counter++;
			};
		})();

		function manualSection(level, sectTitle, content){with($H){
			return div({'class':'section'},
				a({name:'s'+uid()}),
				$H['h'+level]({'class':'title'}, sectTitle),
				div({'class':'navbar'},
					a({'href':'#toc', title:'К оглавлению'}, '&#x2261'), ' ',
					span({'class':'button lnkRoll', href:'#', title:'Свернуть'}, '&#x25B2;')
				),
				div({'class':'sectionContent'},
					content
				)
			);
		}}
		function codesample(lines){with($H){
			return pre({'class':'code'},
				lines instanceof Array?apply(lines, function(ln){return entities(ln)+'\n';})
					:entities(lines)
			);
		}}

		function code(str){
			return $H.span({'class':'code'}, $C.entities(str));
		}

		var errorsDetected = false,
			errors = [];

		function equals(v1, v2){
			if(v1 instanceof Array){
				if(!(v2 instanceof Array)) return false;
				if(v1.length!=v2.length) return false;
				for(var i=0; i<v1.length; i++){if(!equals(v1[i], v2[i])) return false;}
				return true;
			}
			if(typeof(v1)=='object'){
				if(typeof(v2)!='object' || v2 instanceof Array) return false;
				for(var k in v1){if(!equals(v1[k], v2[k])) return false;}
				for(var k in v2){if(!equals(v1[k], v2[k])) return false;}
				return true;
			}
			return v1==v2;
		}

		function assert(val, expected){
			if(!equals(val, expected)){
				errorsDetected = true;
				errors.push('Assertion failed: expected "'+$C.entities(expected)+'", but was "'+$C.entities(val)+'"');
			}
		}

		function assertTrue(val){
			assert(val, true);
		}
		
		test(function(){
			if(!equals([1,2], [1,2])) console.error('Equation test failed');
			if(equals([1,2], null)) console.error('Equation test failed');
			if(equals([1,2], 2)) console.error('Equation test failed');
			if(equals([1,2], [2])) console.error('Equation test failed');
			if(equals([1,2], {x:1})) console.error('Equation test failed');
			if(equals(null, 3)) console.error('Equation test failed');
			if(!equals(null, null)) console.error('Equation test failed');
			if(!equals({x:2, y:3}, {y:3, x:2})) console.error('Equation test failed');
			if(equals({x:2, y:3}, {x:2})) console.error('Equation test failed');
			if(equals({x:2, y:3}, {y:3})) console.error('Equation test failed');
			if(equals({x:2, y:3}, [3])) console.error('Equation test failed');
			if(!equals({x:2, y:{a:1}}, {y:{a:1}, x:2})) console.error('Equation test failed');
			if(!equals(3, 3)) console.error('Equation test failed');
			if(!equals('abc', 'abc')) console.error('Equation test failed');
			if(!equals(true, true)) console.error('Equation test failed');
			if(equals(null, false)) console.error('Equation test failed');
			if(equals(false, null)) console.error('Equation test failed');
		});

		function test(name, group, action){with($H){
			if(arguments.length==1){
				action = name;
				group = name = '';
			}
			else
				name = $H.format('"{0}:{1}"', group, name);
			errors = [];
			action();
			return errors.length?div({'class':'error'}, 
					name, ' ',
					$C.apply(errors, function(e){return div(e)})
				)
				:div({'class':'success'}, 'Test ', name, ' performed');
		}}

		var describedFields = {};

		function referenceManual(prefix, root, doc, showRemaining){with($H){
			if(typeof(doc)=='function') doc = doc();
			return table({border:1, cellpadding:3, cellspacing:0, width:pc(100)},
				$C.apply(doc, function(man, fld){
					describedFields[prefix+'.'+fld] = true;
					var itm = root[fld];
					return tr(
						td(
							itm?null
								:(errorsDetected=true,div({'class':'error'}, 'not defined')), prefix, '.',
							fld,
							typeof(itm)=='function'?'()':null
						),
						td(man)
					);
				}),
				showRemaining?$C.apply(root, function(v, fld){
					return describedFields[prefix+'.'+fld]?null:tr(
						td(
							prefix, '.', fld, 
							typeof(root[fld])=='function'?'()':null
						),
						td((errorsDetected=true,div({'class':'error'}, 'нет описания')))
					);
				}):null
			);
		}}

		function manual(){with($H){
			var markup = $C.markup;
			return div({'class':'manual'},
				h1(Settings.title),
				div({'class':'error pnlErrorsDetected'}, 'Обнаружены ошибки'),
				a({name:'toc'}),
				div({'class':'pnlToc'}),
				manualSection(2, 'Назначение', div(
					p('Программный модуль Clarino предназначен для формирования фрагментов HTML-, XML-, и CSS-кода.')
				)),
				manualSection(2, 'Подключение', div(
					p('Для использования библиотеки Clarino достаточно подключить её к веб-странице:'),
					codesample(['<scr'+'ipt src="clarino.js"></sc'+'ript>']),
					test("Подключение модуля Clarino", "Configuration", function(){
						assert(typeof(Clarino), "object");
					}),
					p('Получение номера версии:'),
					codesample(['Clarino.version()']),
					test(function(){
						assertTrue(Clarino.version().match(/\d+\.\d+\.\d+/)!=null);
					}),
					p('Доступ к интерфейсу заданной версии:'),
					codesample('Clarino.version("1.0.0")'),
					test(function(){
						assertTrue(typeof(Clarino.version('0.0.0').version)=='function');
						assertTrue(typeof(Clarino.version('0.0.0').apply)=='function');
					}),
				)),
				manualSection(2, 'Простая верстка', div(
					test("Простая верстка", "Верстка", function(){
						with(Clarino.simple){
							assert(
								div(
									p("abc"),
									p("def")
								),
								"<div><p>abc</p><p>def</p></div>"
							);
						}
					}),

					test("Простая верстка с атрибутами", "Верстка", function(){
						with(Clarino.simple){
							assert(
								div({
										"class":"panel",
										width:200
									},
									p("abc")
								),
								"<div class=\"panel\" width=\"200\"><p>abc</p></div>"
							);
						}
					}),

					test("Простая таблица", "Верстка", function(){
						with(Clarino.simple){
							assert(
								table({border:0, cellpadding:0, cellspacing:0},
									tr(td("11"), td("12")),
									tr(td("21"), td("22"))
								),
								"<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td>11</td><td>12</td></tr><tr><td>21</td><td>22</td></tr></table>"
							);
						}
					}),

					test("Таблица с пустыми ячейками", "Верстка", function(){
						with(Clarino.simple){
							assert(
								table(
									tr(th("ss"), th("  ")),
									tr(td("11"), td("   ")),
									tr(td(), td("22"))
								),
								"<table><tr><th>ss</th><th>&nbsp;</th></tr><tr><td>11</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>22</td></tr></table>"
							)
						}
					}),

					test("Картинки", "Верстка", function(){
						with(Clarino.simple){
							assert(
								div(
									hr(),
									img({src:"null.gif", width:"10px"}),
									br(),
									p("abc")
								),
								"<div><hr/><img src=\"null.gif\" width=\"10px\"/><br/><p>abc</p></div>"
							);
						}
					}),

					test("tagCollection", "Верстка", function(){
						with(Clarino.simple){
							assert(
								markup(
									div("abc"),
									"def",
									div("ghi")
								),
								"<div>abc</div>def<div>ghi</div>"
							);
						}
					}),
					
					test("Arbitrary Attributes", "Верстка", function(){
						with(Clarino.simple){
							var b = true;
							assert(
								div({width:4},
									b?{height:5}:null,
									!b?{"z-index":3}:null,
									"xxx"
								),
								"<div width=\"4\" height=\"5\">xxx</div>"
							);
						}
					}),

					test("Таблица", "Шаблоны", function(){
						with(Clarino.simple){
							var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
							assert(
								table(
									apply(data, function(el){
										return tr(td(el.nm), td(el.nr))
									})
								),
								"<table><tr><td>abc</td><td>1</td></tr><tr><td>def</td><td>2</td></tr></table>"
							);
						}
					}),

					test("Таблица с раскрашенными строками", "Шаблоны", function(){
						with(Clarino.simple){
							var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}, {nm:"ghi", nr:3}];
							assert(
								table(
									apply(data, function(el, i){
										return tr(i%2?null:{"class":"even"},
											td(el.nm), td(el.nr)
										)
									})
								),
								"<table><tr class=\"even\"><td>abc</td><td>1</td></tr><tr><td>def</td><td>2</td></tr><tr class=\"even\"><td>ghi</td><td>3</td></tr></table>"
							);
						}
					}),

					test("Таблица с заголовком", "Шаблоны", function(){
						with(Clarino.simple){
							var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
							assert(
								table({border:0, cellpadding:3, cellspacing:0},
									tr(th("Name"), th("Number")),
									apply(data, function(el){
										return tr(td(el.nm), td(el.nr))
									})
								),
								"<table border=\"0\" cellpadding=\"3\" cellspacing=\"0\"><tr><th>Name</th><th>Number</th></tr><tr><td>abc</td><td>1</td></tr><tr><td>def</td><td>2</td></tr></table>"
							);
						}
					}),

					test("Таблица с источником данных в структуре", "Шаблоны", function(){
						with(Clarino.simple){
							var data = {
								"John":22,
								"Phill":33,
								"George":44
							};
							assert(
								table(
									apply(data, function(val, nm){
										return tr(
											td(nm),
											td(val)
										);
									})
								),
								"<table><tr><td>John</td><td>22</td></tr><tr><td>Phill</td><td>33</td></tr><tr><td>George</td><td>44</td></tr></table>"
							);
						}
					}),

					test("Нумерация", "Шаблоны", function(){
						with(Clarino.simple){
							var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
							assert(
								div(
									apply(data, function(el, i){
										return p((i+1)+". "+el.nm);
									})
								),
								"<div><p>1. abc</p><p>2. def</p></div>"
							)
						}
					}),

					test("Нумерация с разделителем", "Шаблоны", function(){
						with(Clarino.simple){
							var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
							assert(
								div(
									apply(data, function(el, i){
										return span((i+1)+". "+el.nm);
									}, ", ")
								),
								"<div><span>1. abc</span>, <span>2. def</span></div>"
							)
						}
					}),

					test("Нумерация с разделителем 2", "Шаблоны", function(){
						with(Clarino.simple){
							var data = [1, 2, null, 3, ""];
							assert(
								div(
									apply(data, function(el, i){
										if(el==3) return null;
										return span(el);
									}, ", ", true)
								),
								"<div><span>1</span>, <span>2</span></div>",
								"Error 1"
							)
							assert(
								div(
									apply(data, function(el, i){
										if(el==3) return null;
										return span(el);
									}, ", ", false)
								),
								"<div><span>1</span>, <span>2</span>, <span></span>, , <span></span></div>",
								"Error 2"
							)
						}
					}),

					test("Итерация 1", "Шаблоны", function(){
						with(Clarino.simple){
							assert(
								div(
									repeat(2, function(i){
										return span(i);
									})
								),
								"<div><span>1</span><span>2</span></div>"
							);
						}
					}),

					test("Итерация 2", "Шаблоны", function(){
						with(Clarino.simple){
							assert(
								div(
									p("xyz"),
									repeat(2, function(i){
										return span(i);
									}),
									p("abc")
								),
								"<div><p>xyz</p><span>1</span><span>2</span><p>abc</p></div>"
							);
						}
					}),

					test("Итерация с разделителем", "Шаблоны", function(){
						with(Clarino.simple){
							assert(
								div(
									repeat(2, function(i){
										return span(i);
									}, ", ")
								),
								"<div><span>1</span>, <span>2</span></div>"
							);
						}
					}),
					
				)),
				manualSection(2, 'Справочник', markup(
					manualSection(3, 'Разделы', div(
						referenceManual('Clarino', $C, { 
							html: markup(
								p('Содержит определения HTML-тегов'),
								test(function(){assertTrue(typeof($C.html)=='object');})
							),
							css: markup(
								p('Содержит функции для формирования CSS-таблиц'),
								test(function(){assertTrue(typeof($C.css)=='object');})
							),
							simple: markup(
								p('Содержит упрощенный интерфейс для создания простых веб-форм'),
								test(function(){assertTrue(typeof($C.simple)=='object');})
							)
						})
					)),
					manualSection(3, 'HTML-теги', div(
						referenceManual('Clarino.html', $C.html, function(){
							// https://www.w3schools.com/tags/
							var tags = 'a;abbr;address;area;article;aside;audio;b;base;bdi;bdo;blockquote;body;br;button;canvas;caption;cite;code;col;colgroup;datalist;dd;del;details;dfn;dialog;div;dl;dt;em;embed;fieldset;figcaption;figure;footer;form;h1;h2;h3;h4;h5;h6;head;header;hr;html;i;iframe;img;input;ins;kbd;keygen;label;legend;li;link;main;map;mark;menu;menuitem;meta;meter;nav;nobr;noscript;object;ol;optgroup;option;output;p;param;picture;pre;progress;q;rp;rt;ruby;s;samp;script;section;select;small;source;span;strong;style;sub;summary;sup;svg;table;tbody;td;textarea;tfoot;th;thead;time;title;tr;track;u;ul;var;video;wbr'.split(';');
							var tagDefs = {};
							for(var t,i=0; t=tags[i],i<tags.length; i++){
								tagDefs[t] = markup(
									p($C.entities('Формирует HTML-тег <'+t+'>')),
									test(function(){
										var f = $C.html[t];
										assertTrue(typeof(f)=='function' && f('x')=='<'+t+'>x</'+t+'>');
									})
								);
							}
							return tagDefs;
						})
					)),
					manualSection(3, 'Шаблонизация', div(
						referenceManual('Clarino', $C, {
							apply: markup(
								p('Применяет шаблон к элементам массива или полям объекта')
							),
							repeat: markup('Применяет шаблон указанное число раз'),
							markup: markup('Контейнер для произвольного набора тегов, не формирующий для них родительский тег.')
						})
					)),
					manualSection(3, 'Настройка', div(
						referenceManual('Clarino', $C, {
							version: markup('Возвращает текущую версию модуля или интерфейс для заданной версии'),
							xhtmlMode: markup('Включает режим форматирования XHTML'),
							extend: markup(
								p('Добавляет поля к существующему объекту'),
								test(function(){
									var obj = {x:3};
									$C.extend(obj, {y:'abc'});
									assert(obj, {x:3, y:'abc'});
								})
							),
							compose: markup(
								p('Создает интерфейсный объект из полей и методов Clarino. Используется для создания упрощенных интерфейсов.'),
								p('Получает массив путей к элементам Clarino, которые должны быть включены в новый объект. Вместо массива можно передавать строку, состоящую из путей, разделенных точкой с запятой.'),
								p('Пример:'),
								codesample([
									'var simple = Clarino.compose("version;apply;html.p.html.div");'
								]),
								p('В результате будет получен объект ', code('simple'), ', содержащий методы ', code('version'), ', ', code('apply'), ', ', code('p'), ', и ', code('div'), '.'),
								test(function(){
									var obj = $C.compose('version;apply;html.p;html.div');
									assertTrue(obj.version && typeof(obj.version)=='function' && obj.version()==$C.version());
									assertTrue(obj.apply!=null && typeof(obj.apply)=='function');
									assertTrue(obj.p && typeof(obj.p)=='function');
									assertTrue(obj.div && typeof(obj.div)=='function');
									obj = $C.compose(['version','apply']);
									assertTrue(obj.version && typeof(obj.version)=='function' && obj.version()==$C.version());
									assertTrue(obj.apply!=null && typeof(obj.apply)=='function');
								})
							)
						})
					)),
					manualSection(3, 'Форматирование', div(
						referenceManual('Clarino', $C, {
							tag: markup(
								p('Создает фрагмент разметки с произвольным тегом. Функции передается имя тега, и массив размещаемых в нем значений.'),
								p('Например, вызов ', code('Clarino.tag("a", ["abc"])'), ' вернет строку ', code('"<a>abc</a>"'), '.'),
								test(function(){
									assert(Clarino.tag('a', ['abc']), '<a>abc</a>');
								})
							),
							formatStyle: markup(
								p('Форматирует строку стилей для размещения в атрибуте HTML-элемента'),
								p('Например, следующий вызов'),
								codesample([
									'Clarino.formatStyle({',
									'	width:"100%",',
									'	height:80,',
									'	color:"#f00"',
									'});'
								]),
								p('вернет строку ', code('width:100%;height:80px;color:#f00'), '.'),
								test("Style attribute", "Formatting", function(){ with(Clarino.simple){
									var style = Clarino.formatStyle({
										width:Clarino.css.unit.pc(100),
										height:80,
										color:"#f00"
									});
									assert(style, "width:100%;height:80px;color:#f00");
								}})
							),
							format: markup(
								p('Форматирование строки со вставкой значений'),
								p('Например, ', code('Clarino.format("abc{0}def{1}ghi", 1, 2)'), ' вернет строку ', code('"abc1def2ghi"'), '.'),
								test("format function", "Formatting", function(){ with(Clarino.simple){
									assert(format("abc{0}def", 1), "abc1def");
									assert(format("abc '{0}' def", 1), "abc '1' def");
									assert(format("abc{0}def{1}xxx{2}yyy", 1, "abc", true), "abc1defabcxxxtrueyyy");
								}})
							),
							entities: markup(
								p('Заменяет символы, не допустимые в HTML- или XML-разметке на соответствующие сущности (entity)'),
								p('Например, ', code('Clarino.entities("a<b")'), ' вернет строку ', code('"a&lt;b"'), '.'),
								test('Entities function', 'Formatting', function(){with(Clarino.simple){
									assert(entities('a<b'), 'a&lt;b'),
									assert(entities('<p>xxx</p>'), '&lt;p&gt;xxx&lt;/p&gt;');
									assert(entities('<p>xxx&yyy "aaa" \'b</p>'), '&lt;p&gt;xxx&amp;yyy &quot;aaa&quot; &apos;b&lt;/p&gt;');
								}})
							),
							callFunction: markup(
								p('Формирует строку вызова функции для привязки обработчика события к HTML-элементу'),
								p('При вызове передаются имя вызываемой функции, и список ее аргументов.'),
								p('Например, вызов ', code('Clarino.callFunction("myFunction", 1, "abc", [1,2,3], {x:1, y:2, name:"abba"}),'), ' вернет строку ', code("myFunction(1,'abc',[1,2,3],{x:1,y:2,name:'abba'})"), '.'),
								test("callFunction function", "Formatting", function(){ with(Clarino.simple){
									assert(callFunction("alert", 1), "alert(1)");
									assert(callFunction("alert", "abc"), "alert('abc')");
									assert(callFunction("alert", "ОАО \"Персей\""), "alert('ОАО \\\"Персей\\\"')");
									assert(callFunction("alert", true), "alert(true)");
									assert(callFunction("myFunction", 1, "abc", [1,2,3], {x:1, y:2, name:"abba"}), "myFunction(1,'abc',[1,2,3],{x:1,y:2,name:'abba'})");
									assert(callFunction("clickLink", 12, "@this"), "clickLink(12,this)");
									
								}}),

								test("callFunction function 2", "Formatting", function(){ with(Clarino.simple){
									var idx = 1;
									var id = 2;
									var name="ОАО \"Персей\"";
									assert(
										span({"class":"TEditLinkButton", onclick:callFunction("action", idx, id, name)}, name),
										"<span class=\"TEditLinkButton\" onclick=\"action(1,2,'ОАО \\\"Персей\\\"')\">ОАО \"Персей\"</span>"
									);
								}}),
								),
							json: markup(
								p('Сериализует заданный объект в строку JSON'),
								test("JSON serialization", "Formatting", function(){ with(Clarino.simple){
									assert(Clarino.json(1), "1", "Error 1.1");
									assert(Clarino.json(11), "11", "Error 1.2");
									
									assert(Clarino.json(true), "true", "Error 2.1");
									assert(Clarino.json(false), "false", "Error 2.2");
									
									assert(Clarino.json(""), "''", "Error 3.1");
									assert(Clarino.json("abc def"), "'abc def'", "Error 3.1");
									assert(Clarino.json("1234"), "'1234'", "Error 3.1");
									
									assert(Clarino.json(function(){}), "", "Error 4.1");
									
									assert(Clarino.json([]), "[]", "Error 5.1");
									assert(Clarino.json([1]), "[1]", "Error 5.2");
									assert(Clarino.json([1,2,"xx"]), "[1,2,'xx']", "Error 5.3");
									assert(Clarino.json([1,2,{x:1,y:2}]), "[1,2,{x:1,y:2}]", "Error 5.4");
								}})
							)
						})
					)),
					manualSection(3, 'Объявления', div(
						referenceManual('Clarino', $C, {
							defineTags: markup('Создает набор определений тегов'),
							getTagDefinitions: markup('Создает набор определений тегов'),
							symbols: markup('Создает структуру для хранения строковых констант')
						})
					)),
					manualSection(3, 'CSS', div(
						referenceManual('Clarino.css', $C.css, {
							// writeStylesheet: false,
							// writeRules: false,
							// rules: false,
							// attributes: false,
							// stylesheet: false,
							// writeStylesheet: false,
							// unit: false,
							// keywords: false
						})
					)),
					referenceManual('Clarino', $C, {
						compareVersions:markup(
							p('Сравнивает номера версий. Возвращает 0, если номера одинаковые, 1, если первый номер больше, и -1, если второй номер больше.['),
							test("compareVersions", "Configuration", function(){
								assert(Clarino.compareVersions("1.2.3", "1.2.3"), 0);
								assert(Clarino.compareVersions("2.2.3", "1.2.3"), 1);
								assert(Clarino.compareVersions("1.2.3", "2.2.3"), -1);
								assert(Clarino.compareVersions("1.3.3", "1.2.3"), 1);
								assert(Clarino.compareVersions("1.2.3", "1.3.3"), -1);
								assert(Clarino.compareVersions("1.2.4", "1.2.3"), 1);
								assert(Clarino.compareVersions("1.2.3", "1.2.4"), -1);
											
								assert(Clarino.compareVersions("2.0.9", "2.0.9"), 0);
								assert(Clarino.compareVersions("2.0.10", "2.0.10"), 0);
											
								assert(Clarino.compareVersions("2.0.10", "2.0.9"), 1, "Err 1");
								assert(Clarino.compareVersions("2.0.9", "2.0.10"), -1, "Err 2");
							})
						)
					}, true),
					referenceManual('Clarino.html', $C.html, {}, true),
					// referenceManual('Clarino.simple', $H, {}, true),
					referenceManual('Clarino.css', $C.css, {}, true)
				)),
				manualSection(1, 'Общие тесты', div(






					test("Document type definition", "XML", function(){ with(Clarino.simple){
						var xml = (function(){with(Clarino.getTagDefinitions("library;book")){
							return library(
								book({title:"Война и мир"}),
								book({title:"Капитанская дочка"})
							);
						}})();
						assert(xml, "<library><book title=\"Война и мир\"/><book title=\"Капитанская дочка\"/></library>");
					}}),
					test("Document type definition 2", "XML", function(){ with(Clarino.simple){
						var xml = (function(){with(Clarino.getTagDefinitions(["library", "book"])){
							return library(
								book({title:"Война и мир"}),
								book({title:"Капитанская дочка"})
							);
						}})();
						assert(xml, "<library><book title=\"Война и мир\"/><book title=\"Капитанская дочка\"/></library>");
					}}),

					test("Tag Definitions", "Extensions", function(){ with(Clarino.simple){
						Clarino.defineTags("ss;ssl");
						var html = (function(){with(Clarino.html){
							return ss(
								ssl("abc"),
								ssl("def"),
								p("ghi")
							);
						}})();
						assert(html, "<ss><ssl>abc</ssl><ssl>def</ssl><p>ghi</p></ss>");
					}}),

					test("Tag Definitions 2", "Extensions", function(){ with(Clarino.simple){
						Clarino.defineTags(["ss", "ssl", "_interface"]);
						var html = (function(){with(Clarino.html){
							return ss(
								ssl("abc"),
								ssl("def"),
								p("ghi"),
								_interface("zz")
							);
						}})();
						assert(html, "<ss><ssl>abc</ssl><ssl>def</ssl><p>ghi</p><interface>zz</interface></ss>");
					}}),

					test("Stylesheet", "Extensions", function(){
						var sst = Clarino.css.stylesheet({
							"body":{
								"font-family":"Verdana",
								fontSize:"12px",
								" p":{
									margin:0
								}
							}
						});
						assert(sst, "body{\nfont-family : Verdana ;\nfont-size : 12px ;\n}\nbody p{\nmargin : 0 ;\n}");
					}),

					test("Units", "Extensions", function(){
						var px = Clarino.css.unit("px");
						assert(px(22), "22px");
						assert(px(3, 5, 10), "3px 5px 10px");
						assert(Clarino.css.unit.px(22), '22px');
						assert(Clarino.css.unit.pc(100), '100%');
						assert(Clarino.css.unit.px(22, Clarino.css.keywords.auto), '22px auto');
					}),

					test("CSS Keywords", "Extensions", function(){
						assert(Clarino.css.keywords.none, 'none');
						assert(Clarino.css.keywords.absolute, 'absolute');
					}),

					test("CSS Rules", "Extensions", function(){
						var anm = Clarino.css.rules('@keyframes example', {
							from:{backgroundColor:'red'},
							to:{backgroundColor:'green'}
						});
						
						assert(anm, '@keyframes example{\nfrom{\nbackground-color : red ;\n}\nto{\nbackground-color : green ;\n}\n}');
					})

				))
			);
		}}

		function buildToc(root){with($H){
			root = root || $('.manual');
			function tocLevel(root){
				var content = root.find('>.sectionContent');
				if(!content.length) content = root;
				var sections = content.find('>.section').toArray();
				if(!sections.length) return; // 'NO Sections';
				return ul(
					$C.apply(sections, function(sct){sct=$(sct);
						var sctID = sct.find('a').attr('name'),
							sctTitle = sct.find('.title').html();
						return li(
							a({href:'#'+sctID}, sctTitle),
							tocLevel(sct)
						);
					})
				);
			}
			var hcode = tocLevel(root);
			//console.log(hcode);
			$('.pnlToc').html(hcode);
		}}

		function bindEvents(){
			$('.manual')
				.find('.lnkRoll').click(function(){var self = $(this);
					var pnl = self.parent().parent().find('.sectionContent');
					if(pnl.is(':visible')){
						self.html('&#x25BC;').attr({title:'Развернуть'});
						pnl.fadeOut();
					}
					else{
						self.html('&#x25B2;').attr({title:'Свернуть'});
						pnl.fadeIn();
					}
				}).end()
			;
		}


		$(function(){
			$('head title').html(Settings.title);
			$('body').html(manual());
			bindEvents();
			buildToc();
			if(errorsDetected) $('.pnlErrorsDetected').show();
		});
	})(jQuery, Clarino.version('0.1.0'));
	</script>
</head>
<body></body>
</html>
