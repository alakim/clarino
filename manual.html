<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
	<script src="tools/jquery-3.1.1.min.js"></script>
	<script src="clarino.js"></script>

	<script>
	(function($, $H){
		var px = $H.unit.px,
			pc = $H.unit.pc,
			css = $H.cssKeywords;

		var Settings = {
			title: $H.format('Clarino v.{0} - руководство пользователя', Clarino.version())
		};

		$H.writeStylesheet({
			'.manual':{
				fontFamily: 'Verdana, Arial, Sans-Serif',
				fontSize: px(14),
				' .code':{
					backgroundColor: '#ccc',
					width:px(300)
				},
				' .pnlErrorsDetected':{
					display: css.none,
					backgroundColor: '#ffc',
					padding: px(10),
					fontWeight: css.bold,
					border: px(1)+' solid #f00'
				},
				' .success':{color:'#080'},
				' .error':{color:'#e00'}
			}
		});
		
		function section(title, content){with($H){
			return div(h2(title), content);
		}}
		function codesample(lines){with($H){
			return pre({'class':'code'},
				lines instanceof Array?apply(lines, function(ln){return escape(ln)+'\n';})
					:escape(lines)
			);
		}}

		var errorsDetected = false,
			errors = [];
		function assert(val, expected){
			if(val!=expected){
				errorsDetected = true;
				errors.push('Assertion failed: expected "'+$H.escape(expected)+'", but was "'+$H.escape(val)+'"');
			}
		}

		function test(action){with($H){
			errors = [];
			action();
			return errors.length?div({'class':'error'}, apply(errors, function(e){return div(e)}))
				:div({'class':'success'}, 'test performed');
		}}

		function referenceManual(doc){with($H){
			return table({border:1, cellpadding:3, cellspacing:0, width:pc(100)},
				apply(doc, function(man, fld){
					return tr(
						td($H[fld]?null:(errorsDetected=true,div({'class':'error'}, 'not defined')), fld),
						td(man)
					);
				}),
				apply($H, function(v, fld){
					return doc[fld]?null:tr(
						td(fld),
						td((errorsDetected=true,div({'class':'error'}, 'нет описания')))
					);
				})
			);
		}}

		function manual(){with($H){
			return div({'class':'manual'},
				h1(Settings.title),
				div({'class':'error pnlErrorsDetected'}, 'Обнаружены ошибки'),
				section('Назначение', div(
					p('Программный модуль Clarino предназначен для формирования фрагментов HTML-, XML-, и CSS-кода.')
				)),
				section('Подключение', div(
					p('Для использования библиотеки Clarino достаточно подключить её к веб-странице:'),
					codesample(['<scr'+'ipt src="clarino.js"></sc'+'ript>']),
					p('Получение номера версии:'),
					codesample(['Clarino.version()']),
					p('Доступ к интерфейсу заданной версии:'),
					codesample('Clarino.version("1.0.0")'),
					test(function(){
						assert($H.div('abc'), '<div>abc</div>');
					}),
					test(function(){
						assert($H.a({href:'#'}, 'xx'), '<a href="#">xx</a>');
					})
				)),
				section('Справочник', div(
					referenceManual({
						div:markup('Формирует HTML-тег DIV')
					})
				))
			);
		}}


		$(function(){
			$('head title').html(Settings.title);
			$('body').html(manual());
			if(errorsDetected) $('.pnlErrorsDetected').show();
		});
	})(jQuery, Clarino.version('1.0.0'));
	</script>
</head>
<body></body>
</html>
